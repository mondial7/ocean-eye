<link rel="import" href="../../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../../../bower_components/paper-fab/paper-fab.html">

<link rel="import" href="../../../helpers/ocean-eye-informationitem.html">
<link rel="import" href="../../../helpers/ocean-eye-config.html">

<dom-module id="flipping-cards">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
      }
      ocean-eye-informationitem,
      #mockNewItem {
        min-height: 200px;
        min-width: 150px;
        max-width: 230px;
        background-color: #fff;
        box-shadow: 0px 0px 3px #999;
        cursor: pointer;
        vertical-align: middle;
        box-sizing: border-box;
        margin-right: 20px;
        margin-bottom: 15px;
      }
      #mockNewItem {
        display: inline-block;
        text-align: center;
        font-size: 24px;
        color: #888;
        font-weight: 900;
        padding: 15px;
        background-color: #eee;
      }
      #newInfoForm {
        display: none;
        position: absolute;
      }
      #fabWrapper {
        position: fixed;
        right: var(--page-padding, 15px);
        bottom: var(--page-padding, 15px);
      }
    </style>

    <h4>Flipping Cards</h4>
    <hr />
    <br />

    <!-- <div id="newInfoForm">
      <input />

      TODO use the
      <flipping-cards-form visible="[[formVisible]]" response="{{infoAdded}}">
      </flipping-cards-form>

      <button on-click="_storeItem">ADD</button>
    </div> -->

    <!-- <div id="mockNewItem" on-click="_addInfo">
      TODO svg plus
      <span>New<br>information<br>item</span>
    </div> -->

    <dom-repeat items="[[cards]]" as="item">
      <template>
        <ocean-eye-informationitem
          on-click="_flip"
          info="[[item]]"
          summary></ocean-eye-informationitem>
      </template>
    </dom-repeat>

    <span on-click="_nextStep" id="fabWrapper">
      <paper-fab icon="arrow-forward"></paper-fab>
    </span>

  </template>

  <script>
    class FlippingCards extends Polymer.Element {
      static get is() { return 'flipping-cards'; }
      static get properties() {
        return {
          /**
           * Cards || Information items
           * @type {Array}   [{ name: String, flipped: Boolean }]
           */
          cards: {
            type: Array,
            notify: true,
            reflectToAttribute: true,
            value: () => [],
          },
        }
      }
      /**
       * Flip a card
       * @param {Object}    event
       */
      _flip(e) {
        // get the information-item clicked element
        let element = e.path.filter(
          x => x.nodeName === 'OCEAN-EYE-INFORMATIONITEM'
        )[0]
        // flip property
        element.info.flipped = !element.info.flipped
        // flip visualization
        element.disabled = element.info.flipped
        // notify change to play-view
        this.dispatchEvent(new CustomEvent(CUSTOMEVENTS.UPDATE_ITEMS, {
          detail: { item: element.info }
        }))
      }
      /**
       * Add new informationitem
       */
      _addInfo() {
        // TODO show the form
        // this.formVisible = true
      }
      /**
       * Observe new informatio added
       * @param {Object}    item
       */
      _infoAddedChanged(item) {
        // TODO add item to cards (default selected)
      }
      /**
       * Move to the next step -> 'tuning-problem'
       * Broadcast event listened by 'play-view'
       */
      _nextStep() {
        this.dispatchEvent(new CustomEvent(CUSTOMEVENTS.PLAY_NAVIGATOR, {
          detail: { step: PLAY.TUNING }
        }))
      }
    }

    window.customElements.define(FlippingCards.is, FlippingCards);
  </script>
</dom-module>
